# 📊 Statistics.tsx 리팩토링 계획서

## 🎯 목표
- 1,758줄 → 150줄 이하로 축소 (90% 감소)
- 기능 손실 없이 모듈화 구현
- 버그 발생 최소화를 위한 안전한 단계별 진행

## 📋 단계별 실행 계획

### ✅ 1단계: 타입 정의 분리 (안전도: 높음)
**목표:** 타입 정의를 별도 파일로 분리
**예상 시간:** 10분
**위험도:** 낮음 (타입 정의는 컴파일 타임 체크로 안전)

**작업 내용:**
- `src/types/statistics.ts` 생성
- ViewType, KPIData, KPICardConfig, MiniChartData 이동
- import 구문 정리

**검증 방법:**
- TypeScript 컴파일 에러 확인
- 페이지 로딩 테스트

---

### ✅ 2단계: KPI 설정 분리 (안전도: 높음)
**목표:** KPI 카드 설정을 별도 파일로 분리
**예상 시간:** 15분
**위험도:** 낮음 (순수 설정 데이터)

**작업 내용:**
- `src/config/kpiCardsConfig.tsx` 생성
- defaultKPICards 배열 이동
- 아이콘 import 정리

**검증 방법:**
- KPI 카드 렌더링 확인
- 카드 편집 기능 테스트

---

### ✅ 3단계: 포맷팅 유틸리티 분리 (안전도: 높음)
**목표:** 포맷팅 함수들을 별도 파일로 분리
**예상 시간:** 10분
**위험도:** 낮음 (순수 함수)

**작업 내용:**
- `src/utils/formatters.ts` 생성
- formatCurrency, formatPercent, formatNumber 이동

**검증 방법:**
- 숫자 표시 형식 확인
- 모든 KPI 카드의 값 표시 확인

---

### ✅ 4단계: 날짜 유틸리티 분리 (안전도: 보통)
**목표:** 날짜 관련 함수들을 별도 파일로 분리
**예상 시간:** 20분
**위험도:** 보통 (날짜 로직 복잡)

**작업 내용:**
- `src/utils/dateUtils.ts` 생성
- formatDateString, getDateRange, getRelativeDateRange 이동
- quickDateRanges 설정 이동

**검증 방법:**
- 날짜 필터 동작 확인
- 빠른 날짜 선택 버튼 테스트

---

### ✅ 5단계: KPI 계산 로직 분리 (안전도: 낮음)
**목표:** KPI 데이터 계산 로직을 별도 파일로 분리
**예상 시간:** 30분
**위험도:** 높음 (핵심 비즈니스 로직)

**작업 내용:**
- `src/utils/kpiCalculators.ts` 생성
- kpiData useMemo 로직을 함수로 추출
- 의존성 주입 방식으로 변경

**검증 방법:**
- 모든 KPI 수치 정확성 확인
- 필터 변경 시 재계산 확인
- 성장률 계산 정확성 확인

---

### ✅ 6단계: 차트 데이터 생성기 분리 (안전도: 낮음)
**목표:** 12개+ 차트 데이터 생성 함수들을 별도 파일로 분리
**예상 시간:** 45분
**위험도:** 높음 (복잡한 데이터 변환 로직)

**작업 내용:**
- `src/utils/chartDataGenerators.ts` 생성
- 모든 generate*ChartData 함수들 이동
- 공통 로직 추출 및 중복 제거

**검증 방법:**
- 모든 KPI 카드의 차트 표시 확인
- 필터 변경 시 차트 업데이트 확인
- 일간/주간/월간 차트 전환 테스트

---

### ✅ 7단계: KPICard 컴포넌트 분리 (안전도: 보통)
**목표:** KPICard 컴포넌트를 별도 파일로 분리
**예상 시간:** 20분
**위험도:** 보통 (UI 컴포넌트)

**작업 내용:**
- `src/components/statistics/KPICard.tsx` 생성
- KPICard 컴포넌트와 관련 타입 이동

**검증 방법:**
- KPI 카드 렌더링 확인
- 호버 효과 및 클릭 이벤트 확인

---

### ✅ 8단계: 필터 컴포넌트 분리 (안전도: 보통)
**목표:** 필터 패널을 별도 컴포넌트로 분리
**예상 시간:** 25분
**위험도:** 보통 (상태 관리 포함)

**작업 내용:**
- `src/components/statistics/StatisticsFilters.tsx` 생성
- 필터 관련 JSX와 로직 분리

**검증 방법:**
- 날짜 필터 동작 확인
- 상태 필터 변경 확인
- 차트 표시 단위 변경 확인

---

### ✅ 9단계: 메인 컴포넌트 정리 (안전도: 높음)
**목표:** Statistics 메인 컴포넌트를 150줄 이하로 축소
**예상 시간:** 20분
**위험도:** 낮음 (정리 작업)

**작업 내용:**
- 모든 분리된 모듈 import
- 메인 컴포넌트를 조합 및 상태 관리만 담당하도록 정리
- 주석 및 코드 정리

**검증 방법:**
- 전체 페이지 기능 종합 테스트
- 성능 확인
- 타입 안전성 확인

---

### ✅ 10단계: 최종 테스트 및 문서화 (안전도: 높음)
**목표:** 리팩토링 완료 후 종합 검증
**예상 시간:** 15분
**위험도:** 낮음

**작업 내용:**
- 전체 기능 시나리오 테스트
- 성능 비교 (메모리, 렌더링)
- 리팩토링 완료 문서 작성

---

## 🛡️ 안전 조치

### 각 단계별 체크포인트
1. **컴파일 확인:** TypeScript 에러 없음
2. **기능 테스트:** 해당 기능 정상 동작 확인
3. **회귀 테스트:** 기존 기능 영향 없음 확인
4. **백업:** 각 단계 완료 후 커밋

### 위험 요소 대응 방안
- **높은 위험도 단계:** 더 세분화하여 진행
- **버그 발생 시:** 즉시 이전 단계로 롤백
- **기능 이상 시:** 단계별 커밋으로 복원

## 📊 예상 결과

### Before (현재)
- **파일 수:** 1개
- **코드 라인:** 1,758줄
- **유지보수성:** 매우 낮음
- **테스트 가능성:** 어려움

### After (목표)
- **파일 수:** 8개
- **메인 파일:** ~150줄 (91% 감소)
- **유지보수성:** 높음
- **테스트 가능성:** 용이함

### 파일 구조
```
src/
├── types/statistics.ts                    (~50줄)
├── config/kpiCardsConfig.tsx             (~120줄)
├── utils/
│   ├── formatters.ts                     (~30줄)
│   ├── dateUtils.ts                      (~150줄)
│   ├── kpiCalculators.ts                 (~200줄)
│   └── chartDataGenerators.ts            (~400줄)
├── components/statistics/
│   ├── KPICard.tsx                       (~100줄)
│   └── StatisticsFilters.tsx             (~120줄)
└── pages/Statistics.tsx                   (~150줄)
```

## 🎉 성공 기준
- [ ] 모든 기능이 정상 작동
- [ ] 타입 안전성 유지
- [ ] 성능 저하 없음
- [ ] 메인 파일 200줄 이하
- [ ] 재사용 가능한 모듈 구조 